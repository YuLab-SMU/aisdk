% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/session.R
\name{ChatSession}
\alias{ChatSession}
\title{ChatSession Class}
\description{
R6 class representing a stateful chat session. Automatically manages
conversation history, supports tool execution, and provides persistence.
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-ChatSession-new}{\code{ChatSession$new()}}
\item \href{#method-ChatSession-send}{\code{ChatSession$send()}}
\item \href{#method-ChatSession-send_stream}{\code{ChatSession$send_stream()}}
\item \href{#method-ChatSession-append_message}{\code{ChatSession$append_message()}}
\item \href{#method-ChatSession-get_history}{\code{ChatSession$get_history()}}
\item \href{#method-ChatSession-get_last_response}{\code{ChatSession$get_last_response()}}
\item \href{#method-ChatSession-clear_history}{\code{ChatSession$clear_history()}}
\item \href{#method-ChatSession-switch_model}{\code{ChatSession$switch_model()}}
\item \href{#method-ChatSession-get_model_id}{\code{ChatSession$get_model_id()}}
\item \href{#method-ChatSession-stats}{\code{ChatSession$stats()}}
\item \href{#method-ChatSession-save}{\code{ChatSession$save()}}
\item \href{#method-ChatSession-as_list}{\code{ChatSession$as_list()}}
\item \href{#method-ChatSession-restore_from_list}{\code{ChatSession$restore_from_list()}}
\item \href{#method-ChatSession-print}{\code{ChatSession$print()}}
\item \href{#method-ChatSession-get_memory}{\code{ChatSession$get_memory()}}
\item \href{#method-ChatSession-set_memory}{\code{ChatSession$set_memory()}}
\item \href{#method-ChatSession-list_memory}{\code{ChatSession$list_memory()}}
\item \href{#method-ChatSession-clear_memory}{\code{ChatSession$clear_memory()}}
\item \href{#method-ChatSession-get_envir}{\code{ChatSession$get_envir()}}
\item \href{#method-ChatSession-eval_in_session}{\code{ChatSession$eval_in_session()}}
\item \href{#method-ChatSession-list_envir}{\code{ChatSession$list_envir()}}
\item \href{#method-ChatSession-clone}{\code{ChatSession$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-new"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new ChatSession.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$new(
  model = NULL,
  system_prompt = NULL,
  tools = NULL,
  hooks = NULL,
  history = NULL,
  max_steps = 10,
  registry = NULL,
  memory = NULL,
  envir = NULL,
  agent = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{model}}{A LanguageModelV1 object or model string ID (e.g., "openai:gpt-4o").}

\item{\code{system_prompt}}{Optional system prompt for the conversation.}

\item{\code{tools}}{Optional list of Tool objects for function calling.}

\item{\code{hooks}}{Optional HookHandler object for event hooks.}

\item{\code{history}}{Optional initial message history (list of message objects).}

\item{\code{max_steps}}{Maximum steps for tool execution loops. Default 10.}

\item{\code{registry}}{Optional ProviderRegistry for model resolution.}

\item{\code{memory}}{Optional initial shared memory (list). For multi-agent state sharing.}

\item{\code{envir}}{Optional shared R environment. For multi-agent data sharing.}

\item{\code{agent}}{Optional Agent object. If provided, the session inherits the agent's
tools and system prompt.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-send"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-send}{}}}
\subsection{Method \code{send()}}{
Send a message and get a response.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$send(prompt, ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{prompt}}{The user message to send.}

\item{\code{...}}{Additional arguments passed to generate_text.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The GenerateResult object from the model.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-send_stream"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-send_stream}{}}}
\subsection{Method \code{send_stream()}}{
Send a message with streaming output.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$send_stream(prompt, callback, ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{prompt}}{The user message to send.}

\item{\code{callback}}{Function called for each chunk: callback(text, done).}

\item{\code{...}}{Additional arguments passed to stream_text.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (output is via callback).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-append_message"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-append_message}{}}}
\subsection{Method \code{append_message()}}{
Append a message to the history.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$append_message(role, content)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{role}}{Message role: "user", "assistant", "system", or "tool".}

\item{\code{content}}{Message content.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-get_history"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-get_history}{}}}
\subsection{Method \code{get_history()}}{
Get the conversation history.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$get_history()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A list of message objects.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-get_last_response"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-get_last_response}{}}}
\subsection{Method \code{get_last_response()}}{
Get the last response from the assistant.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$get_last_response()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
The content of the last assistant message, or NULL.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-clear_history"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-clear_history}{}}}
\subsection{Method \code{clear_history()}}{
Clear the conversation history.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$clear_history(keep_system = TRUE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{keep_system}}{If TRUE, keeps the system prompt. Default TRUE.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-switch_model"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-switch_model}{}}}
\subsection{Method \code{switch_model()}}{
Switch to a different model.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$switch_model(model)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{model}}{A LanguageModelV1 object or model string ID.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-get_model_id"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-get_model_id}{}}}
\subsection{Method \code{get_model_id()}}{
Get current model identifier.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$get_model_id()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Model ID string.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-stats"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-stats}{}}}
\subsection{Method \code{stats()}}{
Get token usage statistics.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$stats()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A list with token counts and message stats.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-save"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-save}{}}}
\subsection{Method \code{save()}}{
Save session to a file.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$save(path, format = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{File path (supports .rds or .json extension).}

\item{\code{format}}{Optional format override: "rds" or "json". Auto-detected from path.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-as_list"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-as_list}{}}}
\subsection{Method \code{as_list()}}{
Export session state as a list (for serialization).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$as_list()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A list containing session state.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-restore_from_list"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-restore_from_list}{}}}
\subsection{Method \code{restore_from_list()}}{
Restore session state from a list.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$restore_from_list(data)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{data}}{A list exported by as_list().}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-print"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-print}{}}}
\subsection{Method \code{print()}}{
Print method for ChatSession.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$print()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-get_memory"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-get_memory}{}}}
\subsection{Method \code{get_memory()}}{
Get a value from shared memory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$get_memory(key, default = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{key}}{The key to retrieve.}

\item{\code{default}}{Default value if key not found. Default NULL.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The stored value or default.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-set_memory"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-set_memory}{}}}
\subsection{Method \code{set_memory()}}{
Set a value in shared memory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$set_memory(key, value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{key}}{The key to store.}

\item{\code{value}}{The value to store.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible self for chaining.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-list_memory"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-list_memory}{}}}
\subsection{Method \code{list_memory()}}{
List all keys in shared memory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$list_memory()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character vector of memory keys.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-clear_memory"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-clear_memory}{}}}
\subsection{Method \code{clear_memory()}}{
Clear shared memory.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$clear_memory(keys = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{keys}}{Optional specific keys to clear. If NULL, clears all.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible self for chaining.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-get_envir"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-get_envir}{}}}
\subsection{Method \code{get_envir()}}{
Get the shared R environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$get_envir()}\if{html}{\out{</div>}}
}

\subsection{Details}{
This environment is shared across all agents using this session.
Agents can store and retrieve data frames, models, and other R objects.
}

\subsection{Returns}{
An environment object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-eval_in_session"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-eval_in_session}{}}}
\subsection{Method \code{eval_in_session()}}{
Evaluate an expression in the session environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$eval_in_session(expr)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{An expression to evaluate.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The result of the evaluation.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-list_envir"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-list_envir}{}}}
\subsection{Method \code{list_envir()}}{
List objects in the session environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$list_envir()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character vector of object names.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ChatSession-clone"></a>}}
\if{latex}{\out{\hypertarget{method-ChatSession-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ChatSession$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
